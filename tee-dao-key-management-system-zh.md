# TEE DAO 私钥分片存储系统

## 系统概述

TEE DAO 私钥分片存储系统是一个基于阈值密码学的分布式密钥管理平台，实现了 FROST (Flexible Round-Optimized Schnorr Threshold) 和 ECDSA GG20 协议的安全密钥生成、存储和签名功能。系统通过将私钥分片分布在多个 TEE（可信执行环境）节点中，确保没有单一节点能够获得完整的私钥，从而提供了极高的安全性。

## 核心特性

### 🔐 分布式密钥生成 (DKG)
- **无单点私钥暴露**：私钥从不在单一位置生成或存储
- **阈值密码学**：需要最少 t 个节点合作才能执行签名操作
- **多协议支持**：支持 FROST (Schnorr) 和 ECDSA GG20 两种协议
- **多曲线支持**：支持 ED25519、SECP256K1、SECP256R1 等椭圆曲线

### 🏗️ 分布式架构
- **Raft 共识**：使用 Raft 算法进行分布式决策和领导者选举
- **TEE 环境**：所有关键操作在可信执行环境中进行
- **安全通信**：节点间使用双向 TLS 认证确保通信安全
- **容错设计**：支持节点故障和网络分区的恢复

### 📊 性能监控与自动化
- **实时性能监控**：跟踪任务完成率、执行时间、失败模式
- **自动领导者切换**：基于性能指标自动更换低效领导者
- **负载均衡**：随机选择参与者改善负载分布
- **防抖机制**：防止频繁的领导者切换

### 🔄 密钥生命周期管理
- **密钥重分享**：定期更新密钥分片而不改变公钥
- **自动轮换**：基于时间的自动密钥重分享（默认24小时）

## 系统架构

### 核心组件

#### 1. 节点管理 (Node)
- **节点发现**：自动发现和管理网络中的节点
- **生命周期管理**：处理节点的启动、运行和关闭
- **角色管理**：区分 TEE 节点、网格节点和应用节点

#### 2. 任务管理器 (TaskManager)
- **任务协调**：统一管理 DKG、签名和重分享任务
- **性能监控**：实时跟踪任务执行统计和领导者性能
- **缓存管理**：为不同任务类型维护独立缓存
- **并发控制**：基于信号量的任务并发限制

#### 3. 密钥管理器 (KeyManager)
- **持久化存储**：使用 MongoDB 存储密钥信息和元数据
- **内存缓存**：LRU 缓存提供快速访问
- **序列化**：复杂密码学对象的安全序列化
- **版本控制**：支持密钥版本管理和轮换

#### 4. 通信层 (Communicator)
- **gRPC 服务**：高效的远程过程调用
- **TLS 安全**：双向 TLS 认证保证通信安全
- **连接池**：持久连接与自动重连机制
- **消息路由**：智能消息路由和负载均衡

#### 5. 共识层 (Raft)
- **领导者选举**：自动选择协调节点
- **状态同步**：维护分布式系统状态一致性
- **故障恢复**：处理节点故障和网络分区

### 支持的密码学协议

#### FROST 协议 (Schnorr 签名)
```
轮次 1: 承诺生成
├── 每个参与者生成多项式承诺
├── 广播公开值给所有参与者
└── 点对点发送秘密分片

轮次 2: 分片验证与密钥计算
├── 验证收到的分片对承诺的正确性
├── 计算验证密钥分片
├── 广播验证数据
└── 生成最终群组公钥
```

#### ECDSA GG20 协议
```
轮次 1: 初始设置
├── 生成 Paillier 密钥对和承诺
└── 广播公开组件

轮次 2: 分片分发
├── 生成和验证秘密分片
├── 通过点对点发送加密分片
└── 广播验证数据

轮次 3-4: 零知识证明
├── 生成 PSF (Paillier Schnorr Factorization) 证明
├── 验证所有收到的证明
└── 完成 DKG 并计算验证密钥
```

## 安全模型

### 威胁模型防护
- **恶意少数**：只要少于 t 个节点被攻破，系统就是安全的
- **网络攻击**：所有通信都使用双向 TLS 加密
- **内部威胁**：没有单一节点能够重构私钥
- **可用性**：通过阈值协议实现拜占庭容错

### 访问控制
- **基于证书的认证**：使用 X.509 证书进行节点身份验证
- **基于角色的权限**：不同节点类型具有不同权限
- **API 安全**：gRPC 服务使用 TLS 终端
- **审计日志**：完整的安全事件跟踪

## 许可证

本项目为 TEENet Technology (Hong Kong) Limited 的专有和机密项目。